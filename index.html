<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Homer ‚Äî Focus Dashboard</title>

  <link rel="apple-touch-icon" sizes="180x180"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAB1s8HqAAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVR4nO3RMQEAIAzAsI/9GQkqgD5L6hQd0qgH1xgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8Kz3kAQbqgJ1Qw0QpAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAA9EoQAPRKFAD0ShAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgG8yNQm0wqOeWAAAAABJRU5ErkJggg==" />

  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    :root{
      --bg:#0f172a; --muted:#94a3b8; --text:#e5e7eb;
      --accent:#22c55e; --accent-2:#60a5fa; --border:rgba(255,255,255,.12);
      --card-a: rgba(255,255,255,.06); --card-b: rgba(255,255,255,.03);
      --shadow:0 24px 60px rgba(0,0,0,.45); --radius:18px; --countdown-track: rgba(255,255,255,.18);
      --tb: 88px;
    }
    *{box-sizing:border-box}
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }

    html, body{min-height:100%;height:auto;margin:0;-webkit-text-size-adjust:100%}
    body{
      background:
        radial-gradient(1400px 700px at 50% -200px, #1f2937 0%, var(--bg) 55%),
        linear-gradient(180deg, rgba(96,165,250,.05), rgba(34,197,94,.04));
      color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      padding:28px 14px calc(var(--tb) + env(safe-area-inset-bottom, 0px));
      display:grid; place-items:start center;
      transition: background 0.5s ease;
    }
    .shell{width:min(1150px,96vw); transition: opacity 0.5s ease, filter 0.5s ease;}

    /* HERO */
    .hero{
      position:relative; border-radius:28px; padding:28px 22px; margin-bottom:16px; overflow:hidden;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      backdrop-filter: blur(10px); box-shadow: var(--shadow);
      display: flex; justify-content: space-between; align-items: flex-start;
    }
    .hero-content { flex: 1; }
    .title{
      margin:0 0 6px; font-weight:1000; font-size:clamp(2rem,5.4vw,3.2rem); letter-spacing:.01em; line-height:1.1;
      display:flex; align-items:center; gap:14px; flex-wrap:wrap;
      background: linear-gradient(135deg,#fff,#cbd5e1 60%, #ffffff);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      text-shadow: 0 8px 50px rgba(96,165,250,.18);
    }
    .title-badge{
      padding:6px 10px; border-radius:999px; font-weight:800; font-size:.9rem; color:#041106; border:none;
      background:linear-gradient(135deg, var(--accent) 0%, #16a34a 100%); box-shadow: 0 10px 32px rgba(34,197,94,.25);
    }
    .subtitle{ margin:6px 0 0; color:var(--muted); font-size:clamp(.95rem, 2.2vw, 1.05rem) }

    /* Zen Toggle */
    .zen-toggle {
      background: rgba(255,255,255,0.1); border: 1px solid var(--border);
      color: var(--text); padding: 10px; border-radius: 50%;
      cursor: pointer; font-size: 1.2rem; transition: all 0.3s ease;
    }
    .zen-toggle:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

    /* Tabs */
    .tabs{display:flex; gap:10px; margin:16px 0 18px; flex-wrap:wrap}
    .tab-btn{
      border:1px solid rgba(255,255,255,.18); background:#0b1220; color:var(--text);
      padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:800;
      transition:border-color .2s ease, background .2s ease, transform .06s ease;
    }
    .tab-btn:hover { background: rgba(255,255,255,0.1); }
    .tab-btn.active{
      background:linear-gradient(135deg, var(--accent-2) 0%, #2563eb 100%);
      border:none;color:#041106; box-shadow:0 10px 28px rgba(96,165,250,.28);
    }

    .card{
      background:linear-gradient(180deg,var(--card-a),var(--card-b));
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(8px); padding:22px;
    }

    /* Grid */
    .grid{display:grid; gap:20px; grid-template-columns:repeat(12,1fr)}
    .span-12{grid-column:span 12}
    .span-6{grid-column:span 6}
    .span-4{grid-column:span 4}
    @media (max-width: 860px){ .span-6,.span-4{grid-column:span 12} }

    /* YT Hidden Holders */
    .yt-hidden-player { position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none; left: -9999px; }

    /* Clock */
    .clock{display:flex;align-items:center;justify-content:space-between}
    .clock .time{font-size:clamp(1.6rem,4.2vw,2.4rem);font-weight:900;letter-spacing:.02em}
    .clock .time small{font-weight:700;opacity:.75;font-size:.6em;margin-left:6px}
    .clock .date{color:var(--muted)}
    @media (max-width: 430px){ .clock .time{font-size:1.55rem} }

    /* Weather */
    .weather{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}
    .wx-icon{font-size:2.2rem;line-height:1}
    .wx-main{display:flex;flex-direction:column}
    .wx-place{font-weight:800; cursor: pointer; text-decoration: underline; text-decoration-style: dotted; text-underline-offset: 4px; }
    .wx-place:hover { color: var(--accent-2); }
    .wx-desc{color:var(--muted)}
    .wx-temp{font-size:1.8rem;font-weight:900}

    /* Section */
    h2.section{margin:0 0 8px;font-size:.95rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted)}

    /* Quotes */
    blockquote{margin:10px 0 8px;font-size:clamp(1.2rem,2.5vw + .5rem,2rem);font-weight:900}
    blockquote::before, blockquote::after{content:"‚Äú"; color:var(--accent)}
    blockquote::after{content:"‚Äù"}
    .author{color:var(--muted);font-style:italic}
    .row{display:flex; flex-wrap:wrap; gap:12px; margin-top:16px}
    .btn, a.btn{
      border:1px solid rgba(255,255,255,.18); background:#0b1220; color:var(--text);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:800; text-decoration:none;
      transition: transform .06s ease, border-color .2s ease, background .2s ease; user-select:none;
      display: inline-flex; justify-content: center; align-items: center;
    }
    .btn:active { transform: scale(0.96); }
    .primary{background:linear-gradient(135deg, var(--accent) 0%, #16a34a 100%); border:none; color:#041106}
    .secondary{background:linear-gradient(135deg, var(--accent-2) 0%, #2563eb 100%); border:none; color:#041106}
    .ghost{background:transparent}
    .ghost:hover{background:rgba(255,255,255,.05)}
    .muted{color:var(--muted)}
    .spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.2);border-top-color:var(--accent-2);border-radius:50%;display:inline-block;animation:spin .8s linear infinite;vertical-align:-2px;margin-right:6px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .fade-in{animation:fadeIn .7s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)}}

    /* Custom Select for Quotes */
    select.category-select {
        background: #0b1220; border: 1px solid var(--border); color: var(--text);
        padding: 6px 12px; border-radius: 8px; font-weight: 700; cursor: pointer; outline: none;
    }

    /* Quote countdown chip */
    .count-wrap{position:relative}
    .countdown{
      position:absolute; top:-6px; right:-6px; width:46px; height:46px; border-radius:50%;
      background: radial-gradient(closest-side, rgba(15,23,42,0.92) 70%, transparent 71%),
                  conic-gradient(var(--accent) var(--progress,0%), var(--countdown-track) 0);
      display:grid; place-items:center; box-shadow:0 4px 16px rgba(0,0,0,.35); border:1px solid var(--border);
      font-size:.7rem; color:var(--muted); user-select:none;
    }
    .countdown span{font-variant-numeric:tabular-nums}

    /* Saved quotes */
    .saved-list{display:grid; gap:12px}
    .saved-item{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:14px;
    }
    .saved-meta{display:flex;justify-content:space-between;gap:8px;color:var(--muted);font-size:.9rem;margin-top:6px}
    .empty{color:var(--muted);text-align:center;padding:20px}

    /* Pomodoro */
    .pom-wrap{display:grid; gap:18px; grid-template-columns:repeat(12,1fr); align-items:start}
    .pom-main{grid-column: span 7; display:grid; justify-items:center}
    .pom-side{grid-column: span 5}
    @media (max-width: 980px){ .pom-main, .pom-side{grid-column: span 12} .pom-side{display:grid; justify-items:center} }

    .pom-timer.card{
      display:grid; gap:18px; place-items:center; text-align:center;
      width:100%; max-width:350px; margin-inline:auto; padding:18px;
    }
    .ring{
      --ring-size: 220px; /* smaller */
      position:relative; width:var(--ring-size); height:var(--ring-size); border-radius:50%;
      background:
        radial-gradient(closest-side, rgba(15,23,42,.96) 78%, transparent 80%),
        conic-gradient(var(--accent) var(--pom-progress,0%), rgba(255,255,255,.18) 0);
      box-shadow: 0 20px 60px rgba(34,197,94,.15), 0 0 0 1px var(--border) inset;
      display:grid; place-items:center;
      margin-top: 12px; /* a bit lower under the pill */
    }
    .ring .time{ font-size: clamp(1.9rem, 5.6vw, 2.7rem); font-weight: 1000; letter-spacing: .02em; }
    .mode-pill{
      padding:6px 10px; border-radius:999px; font-weight:900; font-size:.85rem; color:#041106;
      background:linear-gradient(135deg, var(--accent-2) 0%, #2563eb 100%);
    }
    .pom-controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .pom-controls .btn{font-weight:900}
    .preset-row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .preset input{width:70px; border-radius:8px; background:#0b1220; border:1px solid var(--border); color:#fff; padding:6px 8px}
    .meta-row{display:flex; gap:16px; justify-content:center; color:var(--muted); font-size:.95rem; flex-wrap:wrap}

    .tasks .task-row{display:flex; gap:10px; align-items:center}
    .tasks input[type="text"]{flex:1; border-radius:10px; background:#0b1220; border:1px solid var(--border); color:#fff; padding:10px 12px}
    .tasks ul{list-style:none; margin:10px 0 0; padding:0; display:grid; gap:8px; width: 100%;}
    .tasks li{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border);
      border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .tasks li.done{opacity:.7; text-decoration: line-through}
    .tasks .small{font-size:.9rem; color:var(--muted)}

   /* iPhone compact Pomodoro */
    @media (max-width: 430px){
      body{ font-size:15px; }
      .pom-timer.card{ max-width: 320px; padding:14px; gap:14px; }
      .ring{ --ring-size: 160px; margin-top: 10px; }
      .ring .time{ font-size: 1.6rem; letter-spacing:.01em; }
      .mode-pill{ font-size:.8rem; padding:5px 9px; }
      .btn{ padding:9px 12px; font-size:.95rem; border-radius:9px; }
      .pom-controls{ gap:8px; }
      .pom-controls .btn{ flex:1 1 calc(50% - 8px); min-width:128px; }
      .preset-row{ gap:8px; }
      .preset input{ width:60px; padding:5px 7px; }
      .meta-row{ gap:10px; font-size:.88rem; }
      .pom-side > .card{ width:100%; max-width:340px; }
    }

    @media (max-width: 375px){
      .pom-timer.card{ max-width: 300px; padding:12px; gap:12px; }
      .ring{ --ring-size: 140px; }
      .ring .time{ font-size: 1.4rem; }
      .pom-controls .btn{ min-width:120px; }
      .preset input{ width:56px; }
    }

    /* Sticky Footer Toolbar */
    .toolbar{
      position:fixed;
      left:50%; transform:translateX(-50%);
      bottom:calc(16px + env(safe-area-inset-bottom, 0px));
      z-index:50;
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--border); border-radius:999px; padding:10px 12px;
      backdrop-filter: blur(10px); box-shadow: 0 16px 40px rgba(0,0,0,.35);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .tool-btn{
      display:flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px; text-decoration:none;
      color:var(--text); border:1px solid rgba(255,255,255,.18); background:#0b1220; font-weight:800;
      transition: border-color .2s ease, transform .06s ease;
    }
    .tool-btn:hover { background: rgba(255,255,255,0.1); }
    @media (max-width: 480px){
      .toolbar{left:0; right:0; transform:none; margin:0 12px; justify-content:space-between}
      .tool-btn{flex:1 1 auto; justify-content:center; min-width:0}
    }

    /* Footer */
    .site-footer{
      margin-top: 28px;
      text-align: center;
      font-size: .9rem;
      color: var(--muted);
      transition: opacity 0.5s ease;
    }
    .site-footer a{ color: var(--accent-2); font-weight: 700; text-decoration: none; }
    .site-footer a:hover{ text-decoration: underline; }

    /* ===== Home: Focus Tasks + Completed ===== */
    .htasklist{
      display:grid;
      grid-template-columns: repeat( auto-fit, minmax(260px, 1fr) );
      gap:14px;
    }
    .htask-card{
      display:flex; align-items:center; gap:14px;
      padding:12px; border:1px solid var(--border); border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .mini-circle{
      --size:86px; --prog:0deg;
      width:var(--size); height:var(--size); border-radius:50%; flex:0 0 var(--size);
      background:
        radial-gradient(closest-side, rgba(15,23,42,.96) 72%, transparent 74%),
        conic-gradient(var(--accent) var(--prog), rgba(255,255,255,.18) 0);
      display:grid; place-items:center; border:1px solid var(--border); box-shadow:0 10px 28px rgba(0,0,0,.25);
      font-weight:900; letter-spacing:.02em; font-variant-numeric: tabular-nums;
    }
    .htask .meta{display:flex; flex-direction:column; gap:4px}
    .htask .name{font-weight:900; font-size:1.05rem}
    .htask .sub{color:var(--muted); font-size:.95rem}
    .done-list{display:grid; gap:10px; margin-top:12px}
    .done-item{display:flex; justify-content:space-between; gap:10px; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))}
    .pill{padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid var(--border); color:var(--muted); font-size:.85rem}

    @media (max-width:430px){
      .mini-circle{ --size:78px; }
      .htask .name{ font-size:1rem; }
      .htask .sub{ font-size:.9rem; }
    }

    /* Simple tool cards extra */
    .tool-card{text-align:center}
    .tool-card a.btn{display:inline-block;margin-top:10px}

    /* ================= ZEN MODE STYLES ================= */
    body.zen-mode {
      background: #000; /* Pure black or very dark for focus */
      overflow: hidden;
    }
    body.zen-mode .shell {
      width: 100vw; height: 100vh;
      display: grid; place-items: center; align-content: center;
      gap: 20px;
    }
    /* Hide distractions */
    body.zen-mode .hero, 
    body.zen-mode .tabs, 
    body.zen-mode .site-footer, 
    body.zen-mode .toolbar,
    body.zen-mode .weather,
    body.zen-mode .count-wrap,
    body.zen-mode #home-done-card {
      display: none !important;
    }
    /* Center the essential cards */
    body.zen-mode #tab-home, 
    body.zen-mode #tab-pomodoro, 
    body.zen-mode #tab-tools, 
    body.zen-mode #tab-saved {
      display: none; /* Hide standard tab logic */
    }
    /* Special visibility for Zen */
    body.zen-mode .zen-visible {
      display: block !important;
      max-width: 450px; width: 100%; margin: 0 auto;
    }
    
    /* When in Zen mode, we force display specific elements if we want to build a custom view, 
       but simpler: just hide everything except the active tab's clock & pomodoro logic? 
       Actually, let's make Zen Mode simplify the current view.
    */
    body.zen-mode .hero-content { opacity: 0; pointer-events: none; }
    body.zen-mode .zen-toggle { position: fixed; top: 20px; right: 20px; z-index: 100; opacity: 0.5; }
    body.zen-mode .zen-toggle:hover { opacity: 1; }

    /* Alternate Zen Strategy: Pure CSS Hiding based on body class */
    body.zen-mode header.hero { background: transparent; border: none; box-shadow: none; backdrop-filter: none; }
    body.zen-mode .title, body.zen-mode .subtitle { display: none; }
    body.zen-mode .tabs { display: none; }
    body.zen-mode .toolbar { transform: translateY(200%); } 
    body.zen-mode .site-footer { opacity: 0; }
    
    /* In Home Tab: Hide Weather, Quotes, Done list. Keep Clock & Focus Tasks */
    body.zen-mode #tab-home .weather,
    body.zen-mode #tab-home .count-wrap,
    body.zen-mode #tab-home #home-done-card { display: none; }
    
    body.zen-mode .card { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.05); }
    body.zen-mode .clock { justify-content: center; transform: scale(1.2); margin-bottom: 20px; }
    
    /* In Pomodoro Tab: Hide Side panel */
    body.zen-mode .pom-side { display: none; }
    body.zen-mode .pom-main { grid-column: span 12; }
  </style>
</head>
<body>
  <div class="shell">
    <header class="hero">
      <div class="hero-content">
        <div class="title"><span id="greeting">Hello</span> <span class="title-badge">Focus Mode</span></div>
        <div class="subtitle">‚ÄúTrying is the first step towards failure.‚Äù ‚Äî Homer Simpson</div>
      </div>
      <button class="zen-toggle" id="zen-btn" title="Toggle Zen Mode">üßò</button>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="home">Home</button>
      <button class="tab-btn" data-tab="saved">Saved Quotes</button>
      <button class="tab-btn" data-tab="pomodoro">Pomodoro</button>
      <button class="tab-btn" data-tab="tools">Tools</button>
    </div>

    <section id="tab-home" class="tab card">
      <div class="grid">
        <div class="span-6 card">
          <h2 class="section">Clock</h2>
          <div class="clock">
            <div>
              <div class="time" id="clock-time">--:--<small>--</small></div>
              <div class="date" id="clock-date">Loading date‚Ä¶</div>
            </div>
            <div class="clock-icon">üïí</div>
          </div>
        </div>

        <div class="span-6 card">
          <h2 class="section">Weather</h2>
          <div class="weather">
            <div class="wx-icon" id="wx-icon">‚õÖ</div>
            <div class="wx-main">
              <div class="wx-place" id="wx-place" title="Click to change location">Locating‚Ä¶</div>
              <div class="wx-desc" id="wx-desc">‚Äî</div>
            </div>
            <div class="wx-temp" id="wx-temp">--¬∞</div>
          </div>
          <div class="muted" style="margin-top:10px;font-size:.85rem">Powered by open-meteo.com</div>
        </div>

        <div class="span-12 card count-wrap">
          <div class="countdown" id="countdown" title="Time until next quote">
            <span id="countdown-text">15m</span>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <h2 class="section" style="margin:0">Motivation</h2>
            <select id="quote-category" class="category-select">
              <option value="random">üé≤ Random</option>
              <option value="inspirational" selected>üî• Inspirational</option>
              <option value="humor">üòÇ Funny</option>
              <option value="wisdom">ü¶â Stoic/Wisdom</option>
              <option value="technology">üíª Technology</option>
            </select>
          </div>
          
          <p id="status" class="muted"><span class="spinner"></span>Fetching a fresh quote‚Ä¶</p>
          <blockquote id="quote" style="display:none;"></blockquote>
          <div id="byline" class="author" style="display:none;">‚Äî <span id="author"></span></div>

          <div class="row" aria-label="Actions">
            <button id="refresh" class="btn primary">New Quote</button>
            <button id="skip" class="btn secondary">Skip</button>
            <button id="save" class="btn ghost">Save</button>
            <button id="copy" class="btn ghost">Copy</button>
          </div>
        </div>

        <div class="span-12 card" id="home-tasks-card" style="display:none">
          <h2 class="section">Focus Tasks</h2>
          <div class="htasklist" id="home-tasks"></div>
          <div class="muted" id="home-tasks-empty" style="display:none">No open tasks. Add one in Pomodoro ‚Üí Tasks.</div>
        </div>

        <div class="span-12 card" id="home-done-card" style="display:none">
          <h2 class="section">Recently Completed</h2>
          <div class="done-list" id="home-done-list"></div>
        </div>
      </div>
    </section>

    <section id="tab-saved" class="tab card" style="display:none">
      <h2 class="section">Saved Quotes</h2>
      <div class="row" style="margin-bottom:10px">
        <button id="exportSaved" class="btn">Export (.txt)</button>
        <button id="clearSaved" class="btn ghost">Clear All</button>
      </div>
      <div id="savedList" class="saved-list"></div>
      <div id="savedEmpty" class="empty" style="display:none">No saved quotes yet. Save your favorites from the Home tab.</div>
    </section>

    <section id="tab-pomodoro" class="tab card" style="display:none">
      <div class="pom-wrap">
        <div class="pom-main">
          <div class="pom-timer card">
            <div class="mode-pill" id="pom-mode">Focus</div>
            <div class="ring" id="pom-ring"><div class="time" id="pom-time">25:00</div></div>

            <div class="preset-row">
              <div class="preset"><label class="small muted">Focus</label><input id="set-focus" type="number" min="1" value="25"> min</div>
              <div class="preset"><label class="small muted">Short break</label><input id="set-short" type="number" min="1" value="5"> min</div>
              <div class="preset"><label class="small muted">Long break</label><input id="set-long" type="number" min="1" value="15"> min</div>
            </div>

            <div class="pom-controls">
              <button id="pom-start" class="btn primary">Start</button>
              <button id="pom-pause" class="btn ghost">Pause</button>
              <button id="pom-reset" class="btn ghost">Reset</button>
              <button id="pom-skip" class="btn secondary">Skip Phase</button>
            </div>

            <div class="meta-row">
              <div>Pomodoros: <strong id="pom-count">0</strong></div>
              <div>Cycle: <strong id="pom-cycle">1</strong>/4</div>
              <div><label><input type="checkbox" id="pom-notify"> Notifications</label></div>
              <div><label><input type="checkbox" id="pom-voice" checked> Voice lines</label></div>
              <div><label><input type="checkbox" id="pom-sfx" checked> Synth beeps</label></div>
            </div>
          </div>
        </div>

        <div class="pom-side">
          <div class="card tasks">
            <h2 class="section">Tasks</h2>
            <div class="task-row">
              <input id="task-input" type="text" placeholder="Add a task‚Ä¶">
              <button id="task-add" class="btn">Add</button>
            </div>
            <ul id="task-list"></ul>
            <div class="small" style="margin-top:8px">Tip: plan one task per focus session.</div>
          </div>

          <div class="card" style="margin-top:18px">
            <h2 class="section">Hints</h2>
            <div class="muted" style="font-size:.95rem">
              ‚Ä¢ 25/5 is classic: 25 min focus ‚Üí 5 min short break.<br>
              ‚Ä¢ Write a tiny task for each focus block.<br>
              ‚Ä¢ Enable notifications for alerts.<br>
            </div>
          </div>
        </div>
      </div>
    </section>

<section id="tab-tools" class="tab card" style="display:none">
  <h2 class="section">My Tools</h2>
  
  <div class="tools-wrap" style="max-width:860px;margin-inline:auto;">
    <div class="grid">
      <div class="span-4 card tool-card">
        <h3>üß© Nextcloud</h3>
        <p class="muted">Access your personal cloud and files securely.</p>
        <a href="https://cloud.b4it.ro" target="_blank" rel="noopener" class="btn primary">Open Nextcloud</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>üîî Notifications</h3>
        <p class="muted">Receive real-time notifications through ntfy.sh.</p>
        <a href="https://ntfy.b4it.ro/" target="_blank" rel="noopener" class="btn secondary">Open Notifications</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>‚è∞ Reminders</h3>
        <p class="muted">Manage your reminders and schedule tasks.</p>
        <a href="https://reminder.b4it.ro/reminders" target="_blank" rel="noopener" class="btn primary">Open Reminders</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>üìî Journal</h3>
        <p class="muted">Daily notes and reflections.</p>
        <a href="https://journal.b4it.ro" target="_blank" rel="noopener" class="btn primary">Open Journal</a>
      </div>
       
      <div class="span-4 card tool-card">
        <h3>üçø Jellyfin</h3>
        <p class="muted">Your personal media server.</p>
        <a href="https://jellyfin.b4it.ro" target="_blank" rel="noopener" class="btn primary">Open Jellyfin</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>üóíÔ∏è Notes</h3>
        <p class="muted">Quick notes & to-dos.</p>
        <a href="https://tasks.b4it.ro" target="_blank" rel="noopener" class="btn primary">Open Notes</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>‚ú® Gemini</h3>
        <p class="muted">Google's advanced AI.</p>
        <a href="https://gemini.google.com" target="_blank" rel="noopener" class="btn primary">Open Gemini</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>üñºÔ∏è Immich</h3>
        <p class="muted">Photos & Memories.</p>
        <a href="https://immich.b4it.ro" target="_blank" rel="noopener" class="btn primary">Open Immich</a>
      </div>

      <div class="span-4 card tool-card">
        <h3>ü§ñ ChatGPT</h3>
        <p class="muted">AI Conversation.</p>
        <a href="https://chatgpt.com" target="_blank" rel="noopener" class="btn secondary">Open ChatGPT</a>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:28px; text-align:center; padding:24px; max-width:860px; margin-inline:auto;">
    <h2 class="section" style="margin-bottom:16px;">üéß Ambient Sounds</h2>

    <div style="
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:16px;
      justify-items:stretch;
    ">
      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">üåä Ocean</h3>
        <button id="btn-ocean" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Ocean</button>
        <input id="vol-ocean" type="range" min="0" max="100" value="50" style="width:100%;">
      </div>

      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">üî• Fireplace</h3>
        <button id="btn-fire" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Fireplace</button>
        <input id="vol-fire" type="range" min="0" max="100" value="40" style="width:100%;">
      </div>

      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">üåßÔ∏è Rain</h3>
        <button id="btn-rain" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Rain</button>
        <input id="vol-rain" type="range" min="0" max="100" value="60" style="width:100%;">
      </div>

      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">üåßÔ∏èü™ü Jazz</h3>
        <button id="btn-rainywindow" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Jazz</button>
        <input id="vol-rainywindow" type="range" min="0" max="100" value="60" style="width:100%;">
      </div>

      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">‚òï Caf√©</h3>
        <button id="btn-cafe" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Caf√©</button>
        <input id="vol-cafe" type="range" min="0" max="100" value="50" style="width:100%;">
      </div>

      <div class="card" style="padding:16px; text-align:left;">
        <h3 style="margin:0 0 10px;">üé∂ Lo-Fi</h3>
        <button id="btn-lofi" class="btn primary" style="width:100%; margin-bottom:8px; padding:8px 12px; font-size:.95rem;">‚ñ∂Ô∏è Play Lo-Fi</button>
        <input id="vol-lofi" type="range" min="0" max="100" value="50" style="width:100%;">
      </div>
    </div> 

    <div style="margin-top:24px; display:flex; flex-wrap:wrap; justify-content:center; gap:12px;">
      <button id="mix-sleep" class="btn secondary" style="padding:8px 14px; font-size:.95rem;">üåô Sleep Mix</button>
      <button id="mix-rainy" class="btn secondary" style="padding:8px 14px; font-size:.95rem;">üå¶Ô∏è Rainy Mix</button>
      <button id="mix-reading" class="btn secondary" style="padding:8px 14px; font-size:.95rem;">üìñ Reading Mix</button>
      <button id="stop-all" class="btn ghost" style="padding:8px 14px; font-size:.95rem;">‚èπ Stop All</button>
    </div>

    <div id="yt-ocean" class="yt-hidden-player"></div>
    <div id="yt-fire" class="yt-hidden-player"></div>
    <div id="yt-rain" class="yt-hidden-player"></div>
    <div id="yt-rainywindow" class="yt-hidden-player"></div>
    <div id="yt-cafe" class="yt-hidden-player"></div>
    <div id="yt-lofi" class="yt-hidden-player"></div>
    <div id="yt-wind" class="yt-hidden-player"></div>
    <div id="yt-synthwave" class="yt-hidden-player"></div>
  </div>

</section>
    <footer class="site-footer">
      Created with ‚ù§Ô∏è by <a href="#" target="_blank">You</a>
    </footer>
  </div>

  <nav class="toolbar" aria-label="Quick links">
    <a class="tool-btn" href="https://www.youtube.com/" target="_blank" rel="noopener">‚ñ∂Ô∏è YouTube</a>
    <a class="tool-btn" href="https://gemini.google.com" target="_blank" rel="noopener">‚ú® Gemini AI</a>
    <a class="tool-btn" href="https://tasks.b4it.ro" target="_blank" rel="noopener">üóíÔ∏è Notes</a>
    <a class="tool-btn" href="https://www.google.com" target="_blank" rel="noopener">üîé Google</a>
  </nav>

  <script>
    (function() {
      const tb = document.querySelector('.toolbar');
      if (!tb) return;
      function setTBPad() { const h = tb.offsetHeight + 16; document.documentElement.style.setProperty('--tb', h + 'px'); }
      window.addEventListener('load', setTBPad);
      window.addEventListener('resize', setTBPad);
      if ('fonts' in document) document.fonts.addEventListener('loadingdone', setTBPad);
      new MutationObserver(setTBPad).observe(tb, { childList: true, subtree: true, attributes: true });
    })();
  </script>
  <script>
    const tabBtns=[...document.querySelectorAll('.tab-btn')];
    const tabs={
      home:document.getElementById('tab-home'),
      saved:document.getElementById('tab-saved'),
      pomodoro:document.getElementById('tab-pomodoro'),
      tools:document.getElementById('tab-tools')
    };
    function showTab(name){ Object.entries(tabs).forEach(([k,el])=>{ el.style.display=(k===name)?'block':'none'; }); tabBtns.forEach(b=>b.classList.toggle('active', b.dataset.tab===name)); }
    tabBtns.forEach(b=>b.addEventListener('click',()=>showTab(b.dataset.tab)));
  </script>

  <script>
    const zenBtn = document.getElementById('zen-btn');
    zenBtn.addEventListener('click', () => {
      document.body.classList.toggle('zen-mode');
    });
    // Exit Zen Mode on Escape key
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && document.body.classList.contains('zen-mode')) {
        document.body.classList.remove('zen-mode');
      }
    });
  </script>

  <script>
    function updateClock(){
      const now=new Date();
      const hh=now.getHours();
      const mm=now.getMinutes().toString().padStart(2,'0');
      const ss=now.getSeconds().toString().padStart(2,'0');
      const day=new Intl.DateTimeFormat(undefined,{weekday:'long'}).format(now);
      const date=new Intl.DateTimeFormat(undefined,{day:'2-digit',month:'long',year:'numeric'}).format(now);
      
      document.getElementById('clock-time').innerHTML=`${hh.toString().padStart(2,'0')}:${mm}<small>${ss}</small>`;
      document.getElementById('clock-date').textContent=`${day}, ${date}`;

      // Update Greeting
      const greetingEl = document.getElementById('greeting');
      if(greetingEl){
        let g = "Hello";
        if(hh < 12) g = "Good Morning";
        else if(hh < 18) g = "Good Afternoon";
        else g = "Good Evening";
        greetingEl.textContent = g;
      }
    }
    updateClock(); setInterval(updateClock,1000);
  </script>

  <script>
    const WX_CODES={0:["‚òÄÔ∏è","Clear sky"],1:["üå§Ô∏è","Mainly clear"],2:["‚õÖ","Partly cloudy"],3:["‚òÅÔ∏è","Overcast"],45:["üå´Ô∏è","Fog"],48:["üå´Ô∏è","Rime fog"],51:["üå¶Ô∏è","Light drizzle"],53:["üå¶Ô∏è","Drizzle"],55:["üåßÔ∏è","Dense drizzle"],56:["üåßÔ∏è","Freezing drizzle"],57:["üåßÔ∏è","Freezing drizzle"],61:["üå¶Ô∏è","Light rain"],63:["üåßÔ∏è","Rain"],65:["üåßÔ∏è","Heavy rain"],66:["üåßÔ∏è","Freezing rain"],67:["üåßÔ∏è","Freezing rain"],71:["üå®Ô∏è","Light snow"],73:["üå®Ô∏è","Snow"],75:["‚ùÑÔ∏è","Heavy snow"],77:["‚ùÑÔ∏è","Snow grains"],80:["üå¶Ô∏è","Rain showers"],81:["üåßÔ∏è","Rain showers"],82:["‚õàÔ∏è","Violent rain"],85:["üå®Ô∏è","Snow showers"],86:["‚ùÑÔ∏è","Heavy snow showers"],95:["‚õàÔ∏è","Thunderstorm"],96:["‚õàÔ∏è","Thunder + hail"],99:["‚õàÔ∏è","Severe thunder/hail"]};
    
    async function loadWeather(lat,lon,label){
      try {
        const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
        const res=await fetch(url,{cache:'no-store'}); const data=await res.json(); const cw=data.current_weather;
        const [icon,desc]=WX_CODES[cw.weathercode]||["‚õÖ","Weather"];
        document.getElementById('wx-icon').textContent=icon;
        document.getElementById('wx-place').textContent=label;
        document.getElementById('wx-desc').textContent=`${desc} ‚Ä¢ Wind ${Math.round(cw.windspeed)} km/h`;
        document.getElementById('wx-temp').textContent=`${Math.round(cw.temperature)}¬∞`;
      } catch(e) {
        document.getElementById('wx-desc').textContent="Offline";
      }
    }

    function detectWeather(forceManual = false){
      const savedLat = localStorage.getItem('wx_lat');
      const savedLon = localStorage.getItem('wx_lon');
      const savedLabel = localStorage.getItem('wx_label');

      if(!forceManual && savedLat && savedLon) {
        return loadWeather(savedLat, savedLon, savedLabel || "Custom Location");
      }

      const fallback={lat:44.4268,lon:26.1025,label:"Bucharest"}; // Default fallback
      
      if(!('geolocation'in navigator)) return loadWeather(fallback.lat,fallback.lon,fallback.label);
      
      navigator.geolocation.getCurrentPosition(
        pos=>{
          // Auto success
          localStorage.removeItem('wx_lat'); // Clear manual overrides
          loadWeather(pos.coords.latitude,pos.coords.longitude,"Your location");
        },
        _=>{
          // Fail
          loadWeather(fallback.lat,fallback.lon,fallback.label);
        },
        {enableHighAccuracy:false,timeout:8000,maximumAge:600000}
      );
    }

    // Manual location override
    document.getElementById('wx-place').addEventListener('click', () => {
      const input = prompt("Enter Latitude,Longitude (e.g. 40.71,-74.00 for NY) or leave empty to auto-detect:");
      if(input && input.includes(',')) {
        const [lat, lon] = input.split(',');
        localStorage.setItem('wx_lat', lat.trim());
        localStorage.setItem('wx_lon', lon.trim());
        localStorage.setItem('wx_label', "Custom");
        loadWeather(lat.trim(), lon.trim(), "Custom");
      } else {
        localStorage.removeItem('wx_lat');
        localStorage.removeItem('wx_lon');
        detectWeather(true);
      }
    });

    detectWeather();
  </script>

  <script>
    const AUTO_MS = 900_000; // 15 min
    const LOCAL_POOL = [
      {content:"Life is simple. Are you happy? Yes? Keep going. No? Change something.", author:"Unknown"},
      {content:"People who have goals succeed because they know where they're going.", author:"Earl Nightingale"},
      {content:"Your time is limited, so don't waste it living someone else's life.", author:"Steve Jobs"}
    ];

    const els = {
      quote:document.getElementById("quote"),
      author:document.getElementById("author"),
      byline:document.getElementById("byline"),
      status:document.getElementById("status"),
      refresh:document.getElementById("refresh"),
      skip:document.getElementById("skip"),
      save:document.getElementById("save"),
      copy:document.getElementById("copy"),
      countdown:document.getElementById("countdown"),
      countdownText:document.getElementById("countdown-text"),
      savedList:document.getElementById("savedList"),
      savedEmpty:document.getElementById("savedEmpty"),
      exportSaved:document.getElementById("exportSaved"),
      clearSaved:document.getElementById("clearSaved"),
      categorySelect:document.getElementById("quote-category")
    };

    /* persistence helpers */
    const SEEN_KEY ="quotes.seen.v5";
    function getSeen(){ try{return JSON.parse(localStorage.getItem(SEEN_KEY)||"[]");}catch{return[]} }
    function pushSeen(txt){ const arr=getSeen(); const t=txt.toLowerCase(); if(!arr.includes(t)){arr.unshift(t); localStorage.setItem(SEEN_KEY,JSON.stringify(arr.slice(0,1600)));}}
    function isSeen(txt){ return getSeen().includes(txt.toLowerCase()); }

    /* rendering helpers */
    function setLoading(show){ els.status.style.display=show?"block":"none"; els.quote.style.display=show?"none":"block"; els.byline.style.display=show?"none":"block"; }
    function fadeIn(){ els.quote.classList.remove('fade-in'); els.byline.classList.remove('fade-in'); void els.quote.offsetWidth; els.quote.classList.add('fade-in'); els.byline.classList.add('fade-in'); }
    function renderQuote(q){
      const txt=q.content||"Stay motivated."; const ath=q.author||"Unknown";
      els.quote.textContent=txt; els.author.textContent=ath;
      setLoading(false); fadeIn(); pushSeen(txt); resetCountdown();
    }

    const QUOTABLE_BASE = "https://api.quotable.io/quotes/random";
    const proxy = (u) => "https://api.allorigins.win/raw?url=" + encodeURIComponent(u);

    async function tryFetchJSON(url) {
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    }

    async function tryDirectThenProxy(url) {
      try { return await tryFetchJSON(url); }
      catch { return await tryFetchJSON(proxy(url)); }
    }

    async function fetchQuote() {
      const cat = els.categorySelect.value;
      let apiUrl = QUOTABLE_BASE;
      
      // Map selection to tags
      if (cat !== 'random') {
        apiUrl += `?tags=${cat}`;
      } else {
        // Default tags for random to keep it relatively safe/good
        apiUrl += `?tags=inspirational|motivational`; 
      }

      // Try fetching
      try {
        const d = await tryDirectThenProxy(apiUrl);
        const item = Array.isArray(d) ? d[0] : d;
        if (item?.content && item?.author) {
          return { content: item.content, author: item.author };
        }
      } catch (e) {
        console.warn("API fail, using local pool");
      }
      
      // Fallback
      return LOCAL_POOL[Math.floor(Math.random() * LOCAL_POOL.length)];
    }

    /* countdown (15 min auto-refresh) */
    let deadline = Date.now()+AUTO_MS, cdTimer=null;
    function resetCountdown(){
      deadline = Date.now()+AUTO_MS;
      tickCountdown();
    }
    function tickCountdown(){
      if(cdTimer) cancelAnimationFrame(cdTimer);
      const now=Date.now();
      let rem=Math.max(0, deadline-now);
      const mins=Math.floor(rem/60000);
      const secs=Math.floor((rem%60000)/1000);
      els.countdownText.textContent = mins>0 ? `${mins}m` : `${secs}s`;
      const pct = 100 - Math.round((rem/AUTO_MS)*100);
      els.countdown.style.setProperty('--progress', pct + '%');
      if(rem<=0){
        els.refresh.click();
      }else{
        cdTimer=requestAnimationFrame(tickCountdown);
      }
    }

    /* button actions */
    els.refresh.addEventListener("click",async()=>{
      setLoading(true);
      const q = await fetchQuote();
      renderQuote(q);
    });
    
    // Refresh when category changes
    els.categorySelect.addEventListener("change", async() => {
       setLoading(true);
       const q = await fetchQuote();
       renderQuote(q);
    });

    els.skip.addEventListener("click",()=>els.refresh.click());

    els.copy.addEventListener("click",()=>{
      const txt=`"${els.quote.textContent}" ‚Äî ${els.author.textContent}`;
      navigator.clipboard.writeText(txt);
      const p=els.copy.textContent;
      els.copy.textContent="Copied!";
      setTimeout(()=>els.copy.textContent=p,1500);
    });

    /* saved-quotes handling */
    const SAVED_KEY="motivator.savedQuotes.v1";
    function loadSaved(){ try{ return JSON.parse(localStorage.getItem(SAVED_KEY)||"[]"); }catch{return [];} }
    function saveSaved(list){ localStorage.setItem(SAVED_KEY,JSON.stringify(list)); }
    function addCurrentToSaved(){
      const q=els.quote.textContent.trim(), a=els.author.textContent.trim(); if(!q) return;
      const list=loadSaved();
      if(!list.some(it=>it.q===q && it.a===a)){
        list.unshift({q,a,ts:Date.now()});
        saveSaved(list);
        renderSaved();
        const prev=els.save.textContent;
        els.save.textContent="Saved ‚úì";
        setTimeout(()=>els.save.textContent=prev,1100);
      }
    }
    function deleteSaved(idx){ const list=loadSaved(); list.splice(idx,1); saveSaved(list); renderSaved(); }
    function clearAllSaved(){ saveSaved([]); renderSaved(); }
    function renderSaved(){
      const list=loadSaved(); const empty=(list.length===0);
      els.savedList.innerHTML="";
      els.savedEmpty.style.display=empty?"block":"none";
      list.forEach((it,idx)=>{
        const wrap=document.createElement('div'); wrap.className="saved-item";
        wrap.innerHTML=`<div><strong>‚Äú${it.q}‚Äù</strong></div>
          <div class="saved-meta"><span>‚Äî ${it.a||"Unknown"}</span><span>${new Date(it.ts).toLocaleString()}</span></div>
          <div class="row" style="margin-top:10px">
            <button class="btn ghost" data-act="copy" data-i="${idx}">Copy</button>
            <button class="btn" data-act="del" data-i="${idx}">Delete</button>
          </div>`;
        els.savedList.appendChild(wrap);
      });
    }
    els.savedList?.addEventListener('click',e=>{
      const btn=e.target.closest('button'); if(!btn) return;
      const idx=+btn.dataset.i; const list=loadSaved(); const it=list[idx]; if(!it) return;
      if(btn.dataset.act==='del') deleteSaved(idx);
      if(btn.dataset.act==='copy') navigator.clipboard.writeText(`‚Äú${it.q}‚Äù ‚Äî ${it.a||"Unknown"}`);
      
    });
    els.exportSaved?.addEventListener('click',()=>{
      const list=loadSaved();
      const text=list.map(it=>`‚Äú${it.q}‚Äù ‚Äî ${it.a||"Unknown"}`).join("\n\n"); // fixed
      const blob=new Blob([text],{type:'text/plain'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='saved-quotes.txt'; a.click(); URL.revokeObjectURL(url);
    });
    els.clearSaved?.addEventListener('click',clearAllSaved);
    els.save.addEventListener("click",addCurrentToSaved);

    /* initial display ‚Äì fetch immediately */
    els.refresh.click();
    renderSaved();
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const PKEY='pom.settings.v1', TKEY='pom.tasks.v1', SKEY='pom.state.v1';
      const elTime=document.getElementById('pom-time');
      const elRing=document.getElementById('pom-ring');
      const elMode=document.getElementById('pom-mode');
      const elCount=document.getElementById('pom-count');
      const elCycle=document.getElementById('pom-cycle');
      const elNotify=document.getElementById('pom-notify');
      const elVoice=document.getElementById('pom-voice');
      const elSfx=document.getElementById('pom-sfx');
      const elSetFocus=document.getElementById('set-focus');
      const elSetShort=document.getElementById('set-short');
      const elSetLong=document.getElementById('set-long');

      const btnStart=document.getElementById('pom-start');
      const btnPause=document.getElementById('pom-pause');
      const btnReset=document.getElementById('pom-reset');
      const btnSkip=document.getElementById('pom-skip');

      function loadJSON(k,def){ try{ return JSON.parse(localStorage.getItem(k)||JSON.stringify(def)); }catch{return def;} }
      function saveJSON(k,v){ localStorage.setItem(k,JSON.stringify(v)); }

      const settings=loadJSON(PKEY,{focus:25, short:5, long:15, longEvery:4});
      const state=loadJSON(SKEY,{mode:'focus', remaining:settings.focus*60, running:false, pomodoros:0});
      elSetFocus.value=settings.focus; elSetShort.value=settings.short; elSetLong.value=settings.long;
      elMode.textContent=cap(state.mode); updateTime(); updateRing(); updateMeta();

      function cap(s){ return s.charAt(0).toUpperCase()+s.slice(1); }
      function durFor(mode){ return (mode==='focus'?settings.focus:mode==='short'?settings.short:settings.long)*60; }
      function setMode(next){ state.mode=next; state.remaining=durFor(next); elMode.textContent=cap(next); updateTime(); updateRing(); save(); }
      function updateTime(){ const m=Math.floor(state.remaining/60).toString().padStart(2,'0'); const s=Math.floor(state.remaining%60).toString().padStart(2,'0'); elTime.textContent=`${m}:${s}`; }
      function updateRing(){ const total=durFor(state.mode); const progress=1-(state.remaining/total); const deg=Math.max(0,Math.min(360,progress*360)); elRing.style.setProperty('--pom-progress',`${deg}deg`); }
      function updateMeta(){ elCount.textContent=state.pomodoros; elCycle.textContent=((state.pomodoros % settings.longEvery)||settings.longEvery); }
      function save(){ saveJSON(SKEY,state); }

      /* sound + voice */
      let ac;
      function ensureAC(){ if(!ac){ ac = new (window.AudioContext||window.webkitAudioContext)(); } if(ac.state==='suspended'){ ac.resume(); } }
      function speak(text){ if(!elVoice?.checked) return; if(!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(text); u.rate=1.05; u.pitch=text.includes('Woo')?1.3:0.8; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); }
      function tone(freq,dur,type='triangle',vol=0.22,when=0){ if(!elSfx?.checked) return; ensureAC(); const t=ac.currentTime+when; const o=ac.createOscillator(); const g=ac.createGain(); o.type=type; o.frequency.setValueAtTime(freq,t); g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(vol,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur); o.connect(g).connect(ac.destination); o.start(t); o.stop(t+dur+0.02); }
      function sfxWooHoo(){ speak("Woo-hoo!"); tone(880,0.12,'triangle',0.25,0); tone(1046.5,0.12,'triangle',0.22,0.10); tone(1318.5,0.18,'triangle',0.22,0.22); }
      function sfxDoh(){ speak("D‚Äôoh!"); tone(196,0.18,'sawtooth',0.25,0); tone(147,0.18,'sawtooth',0.20,0.10); }

      ['click','keydown','touchstart'].forEach(evt=>{
        window.addEventListener(evt,()=>{ try{ ensureAC(); if('speechSynthesis' in window) speechSynthesis.resume(); }catch(_){ } },{once:true, passive:true});
      });

      let tick=null;
      function start(){ if(state.running) return; state.running=true; save(); if(elNotify?.checked && 'Notification' in window && Notification.permission!=='granted'){ Notification.requestPermission(); } ensureAC(); tick=setInterval(()=>{ state.remaining--; if(state.remaining<=0){ advance(); } updateTime(); updateRing(); save(); window.dispatchEvent(new Event('pom-tick')); },1000); }
      function pause(){ state.running=false; clearInterval(tick); save(); }
      function reset(){ pause(); state.remaining=durFor(state.mode); updateTime(); updateRing(); save(); }
      function skip(){ pause(); advance(true); }

      function advance(){
        if(state.mode==='focus'){
          state.pomodoros++;
          const n=state.pomodoros % settings.longEvery;
          setMode(n===0?'long':'short');
          notify('Break time', n===0?`Long break (${settings.long}m)`:`Short break (${settings.short}m)`);
          sfxWooHoo();
        }else{
          setMode('focus');
          notify('Focus time', `${settings.focus} minutes ‚Äî go!`);
          sfxDoh();
        }
        updateMeta(); save(); if(state.running) start();
      }
      function notify(title,body){
        if(!elNotify?.checked) return;
        if('Notification' in window && Notification.permission==='granted'){
          const n=new Notification(title,{body}); setTimeout(()=>n.close(),4000);
        }
      }

      btnStart.addEventListener('click',start);
      btnPause.addEventListener('click',pause);
      btnReset.addEventListener('click',reset);
      btnSkip.addEventListener('click',skip);

      [elSetFocus, elSetShort, elSetLong].forEach(inp=>{
        inp.addEventListener('change',()=>{
          settings.focus=Math.max(1,parseInt(elSetFocus.value||25));
          settings.short=Math.max(1,parseInt(elSetShort.value||5));
          settings.long=Math.max(1,parseInt(elSetLong.value||15));
          saveJSON(PKEY,settings);
          if(!state.running){ state.remaining=durFor(state.mode); updateTime(); updateRing(); save(); }
        });
      });

      /* Tasks */
      const taskInput=document.getElementById('task-input');
      const taskAdd=document.getElementById('task-add');
      const taskList=document.getElementById('task-list');
      function loadTasks(){ return loadJSON(TKEY,[]); }
      function saveTasks(list){ saveJSON(TKEY,list); }
      function renderTasks(){
        const list=loadTasks();
        taskList.innerHTML='';
        list.forEach((t,i)=>{
          const li=document.createElement('li');
          li.className = t.done?'done':'';
          li.innerHTML= `<input type="checkbox" data-i="${i}" ${t.done?'checked':''}>
            <span style="flex:1">${t.text}</span>
            <button class="btn ghost" data-act="del" data-i="${i}">Delete</button>`;
          taskList.appendChild(li);
        });
        window.dispatchEvent(new Event('tasks-changed'));
      }
      function addTask(){
        const text=taskInput.value.trim(); if(!text) return;
        const list=loadTasks(); list.unshift({text,done:false,ts:Date.now()});
        saveTasks(list); taskInput.value=''; renderTasks();
      }
      taskAdd.addEventListener('click',addTask);
      taskInput.addEventListener('keydown',e=>{ if(e.key==='Enter') addTask(); });
      taskList.addEventListener('click',e=>{
        const i=e.target.dataset.i; if(i==null) return;
        const list=loadTasks();
        if(e.target.matches('input[type="checkbox"]')){ list[i].done=e.target.checked; list[i].ts=Date.now(); }
        if(e.target.dataset.act==='del'){ list.splice(i,1); }
        saveTasks(list); renderTasks();
      });

      if(state.running){ start(); }
      renderTasks();
    });
  </script>

  <script>
    function fmtMMSS(totalSeconds){ const s=Math.max(0,Math.floor(totalSeconds)); const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }
    const LS='pom.state.v1', LS_SETTINGS='pom.settings.v1', LS_TASKS='pom.tasks.v1';
    function ls(k,def){ try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(def));}catch{return def;} }
    function getOpenTasks(){ const tasks=ls(LS_TASKS,[]); return tasks.filter(t=>!t.done); }
    function getDoneTop3(){ const tasks=ls(LS_TASKS,[]); return tasks.filter(t=>t.done).sort((a,b)=>(b.ts||0)-(a.ts||0)).slice(0,3); }

    function renderHomeFromPom(){
      const state=ls(LS, null);
      const settings=ls(LS_SETTINGS,{focus:25, short:5, long:15});
      const openTasks=getOpenTasks();
      const done=getDoneTop3();

      const tasksCard=document.getElementById('home-tasks-card');
      const tasksWrap=document.getElementById('home-tasks');
      const tasksEmpty=document.getElementById('home-tasks-empty');
      const doneCard=document.getElementById('home-done-card');
      const doneList=document.getElementById('home-done-list');

      tasksWrap.innerHTML='';
      if(openTasks.length===0){
        tasksCard.style.display='block'; tasksEmpty.style.display='block';
      }else{
        tasksCard.style.display='block'; tasksEmpty.style.display='none';
        const isFocus=state&&state.mode==='focus';
        const totalFocus=(settings.focus||25)*60;
        const remaining=Math.max(0,(state?.remaining||totalFocus));
        const progressDeg=360*(1-(remaining/totalFocus));
        openTasks.forEach((t,i)=>{
          const card=document.createElement('div'); card.className='htask-card htask';
          const circle=document.createElement('div'); circle.className='mini-circle';
          const leftSpan=document.createElement('span');
          leftSpan.textContent=(i===0&&isFocus)?fmtMMSS(remaining):'--:--';
          circle.appendChild(leftSpan);
          circle.style.setProperty('--prog',(i===0&&isFocus)?`${progressDeg}deg`:'0deg');
          const meta=document.createElement('div'); meta.className='meta';
          const name=document.createElement('div'); name.className='name'; name.textContent=t.text;
          const sub=document.createElement('div'); sub.className='sub';
          sub.textContent=(i===0)?(isFocus?(state.running?'Focus ‚Ä¢ running':'Focus ‚Ä¢ paused'): 'Pomodoro not in Focus'):'Queued';
          meta.appendChild(name); meta.appendChild(sub);
          card.appendChild(circle); card.appendChild(meta);
          tasksWrap.appendChild(card);
        });
      }

      doneList.innerHTML='';
      if(done.length===0) doneCard.style.display='none';
      else{
        doneCard.style.display='block';
        done.forEach(t=>{ const row=document.createElement('div'); row.className='done-item'; row.innerHTML=`<span>${t.text}</span><span class="pill">${new Date(t.ts||Date.now()).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span>`; doneList.appendChild(row); });
      }
    }

    renderHomeFromPom();
    setInterval(renderHomeFromPom,1000);
    window.addEventListener('pom-tick',renderHomeFromPom);
    window.addEventListener('tasks-changed',renderHomeFromPom);
  </script>

  <script>
    (function(){
      const png1x1="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==";
      const icon192="data:image/png;base64,"+png1x1;
      const icon512="data:image/png;base64,"+png1x1;
      const manifest={
        name:"Homer ‚Äî safe place",
        short_name:"Homer",
        start_url:"/?",
        display:"standalone",
        background_color:"#0f172a",
        theme_color:"#0f172a",
        icons:[
          {src:icon192,sizes:"192x192",type:"image/png",purpose:"any"},
          {src:icon512,sizes:"512x512",type:"image/png",purpose:"any"}
        ]
      };
      const murl=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:"application/manifest+json"}));
      const link=document.createElement('link'); link.rel='manifest'; link.href=murl; document.head.appendChild(link);
      const swCode=`const CACHE='homer-v1'; const APP_SHELL=['/','/index.html'];
        self.addEventListener('install',e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(APP_SHELL)).then(()=>self.skipWaiting())); })
        self.addEventListener('activate',e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k)))).then(()=>self.clients.claim())); })
        self.addEventListener('fetch',e=>{
          const url=new URL(e.request.url);
          const isExternal=url.origin!==self.location.origin;
          const isAPI=url.hostname.includes('open-meteo.com')
                    || url.hostname.includes('youtube.com')
                    || url.hostname.includes('googlevideo.com')
                    || url.hostname.includes('zenquotes.io')
                    || url.hostname.includes('allorigins.win');
          if(isExternal||isAPI){
            e.respondWith(fetch(e.request).catch(()=>new Response('',{status:503}))); return;
          }
          e.respondWith(fetch(e.request).then(res=>{const copy=res.clone(); caches.open(CACHE).then(c=>c.put(e.request,copy)); return res; }).catch(()=>caches.match(e.request)));
        })`;
      if('serviceWorker'in navigator){
        const swUrl=URL.createObjectURL(new Blob([swCode],{type:'text/javascript'}));
        window.addEventListener('load',()=>navigator.serviceWorker.register(swUrl).then(r=>r.update()).catch(()=>{}));
      }
    })();
  </script>
<script>
const tracks = {
  ocean: { id:"WHPEKLQID4U", btn:"btn-ocean", vol:"vol-ocean", labelPlay:"‚ñ∂Ô∏è Play Ocean üåä", labelPause:"‚è∏Ô∏è Pause Ocean üåä", holder:"yt-ocean" },
  fire:  { id:"UgHKb_7884o", btn:"btn-fire",  vol:"vol-fire",  labelPlay:"‚ñ∂Ô∏è Play Fireplace üî•", labelPause:"‚è∏Ô∏è Pause Fireplace üî•", holder:"yt-fire" },
  rain:  { id:"mPZkdNFkNps", btn:"btn-rain",  vol:"vol-rain",  labelPlay:"‚ñ∂Ô∏è Play Rain üåßÔ∏è", labelPause:"‚è∏Ô∏è Pause Rain üåßÔ∏è", holder:"yt-rain" },
  rainywindow: { id:"Dx5qFachd3A", btn:"btn-rainywindow", vol:"vol-rainywindow", labelPlay:"‚ñ∂Ô∏è Play Jazz üåßÔ∏èü™ü", labelPause:"‚è∏Ô∏è Pause Jazz üåßÔ∏èü™ü", holder:"yt-rainywindow" },
  cafe:  { id:"uiMXGIG_DQo", btn:"btn-cafe",  vol:"vol-cafe",  labelPlay:"‚ñ∂Ô∏è Play Caf√© ‚òï", labelPause:"‚è∏Ô∏è Pause Caf√© ‚òï", holder:"yt-cafe" },
  lofi:  { id:"Na0w3Mz46GA", btn:"btn-lofi",  vol:"vol-lofi",  labelPlay:"‚ñ∂Ô∏è Play Lo-Fi üé∂", labelPause:"‚è∏Ô∏è Pause Lo-Fi üé∂", holder:"yt-lofi" },
  wind: { id:"jYu1-CxNqks", btn:"btn-wind", vol:"vol-wind", labelPlay:"‚ñ∂Ô∏è Play wind üçÉ", labelPause:"‚è∏Ô∏è Pause windüçÉ ", holder:"yt-wind" },
  synthwave: { id:"4xDzrJKXOOY", btn:"btn-synthwave", vol:"vol-synthwave", labelPlay:"‚ñ∂Ô∏è Play Synthwave üìö", labelPause:"‚è∏Ô∏è Pause Synthwave üìö", holder:"yt-synthwave" },
  weightless: { id:"vYIYIVmOo3Q", btn:null, vol:null, holder:"yt-weightless" } // no button, used only in mix
};

function onYouTubeIframeAPIReady() {
  Object.keys(tracks).forEach(k => {
    const t = tracks[k];
    t.player = new YT.Player(t.holder, {
      height: "0",
      width: "0",
      videoId: t.id,
      playerVars: { autoplay: 0, controls: 0, loop: 1, playlist: t.id, modestbranding: 1 },
      events: {
        onReady: e => {
          const volEl = t.vol ? document.getElementById(t.vol) : null;
          const v = volEl ? +volEl.value : 50;
          e.target.setVolume(v);
        }
      }
    });
  });
}

function togglePlay(k) {
  const t = tracks[k];
  const p = t.player;
  const btn = document.getElementById(t.btn);
  if (!p) return;
  const st = p.getPlayerState();
  if (st === YT.PlayerState.PLAYING) {
    p.pauseVideo();
    btn.textContent = t.labelPlay;
  } else {
    p.playVideo();
    btn.textContent = t.labelPause;
  }
}

function setVolume(k, v) {
  const t = tracks[k];
  if (t.player && typeof t.player.setVolume === "function") {
    t.player.setVolume(v);
  }
}

function stopAll() {
  Object.keys(tracks).forEach(k => {
    const t = tracks[k];
    if (t.player) t.player.pauseVideo();
    if (t.btn) document.getElementById(t.btn).textContent = t.labelPlay;
  });
}

/* üåô Sleep Mix */
function applySleepMix() {
  stopAll();
  setVolume("fire", 40);
  setVolume("rain", 60);
  tracks.fire.player.playVideo();
  tracks.rain.player.playVideo();
  document.getElementById(tracks.fire.btn).textContent = tracks.fire.labelPause;
  document.getElementById(tracks.rain.btn).textContent = tracks.rain.labelPause;
}

/* üå¶Ô∏è Rainy Mix */
function applyRainyMix() {
  stopAll();
  setVolume("rain", 70);
  setVolume("ocean", 40);
  tracks.rain.player.playVideo();
  tracks.ocean.player.playVideo();
  document.getElementById(tracks.rain.btn).textContent = tracks.rain.labelPause;
  document.getElementById(tracks.ocean.btn).textContent = tracks.ocean.labelPause;
}

/* üìñ Reading Mix */
function applyReadingMix() {
  stopAll();
  setVolume("lofi", 50);
  setVolume("fire", 10);
  setVolume("wind", 10);
  setVolume("rain", 10);

  tracks.lofi.player.playVideo();
  tracks.fire.player.playVideo();
  tracks.wind.player.playVideo();
  tracks.rain.player.playVideo();


  document.getElementById(tracks.lofi.btn).textContent = tracks.lofi.labelPause;
  document.getElementById(tracks.fire.btn).textContent = tracks.fire.labelPause;
  document.getElementById(tracks.rain.btn).textContent = tracks.rain.labelPause;
  document.getElementById(tracks.wind.btn).textContent = tracks.wind.labelPause;
}


/* üè† Cozy Night In */
function applyCozyMix() {
  stopAll();
  setVolume("fire", 40);
  setVolume("rain", 40);
  setVolume("rainywindow", 30);
  tracks.fire.player.playVideo();
  tracks.rain.player.playVideo();
  tracks.rainywindow.player.playVideo();
  document.getElementById(tracks.fire.btn).textContent = tracks.fire.labelPause;
  document.getElementById(tracks.rain.btn).textContent = tracks.rain.labelPause;
  document.getElementById(tracks.rainywindow.btn).textContent = tracks.rainywindow.labelPause;
}

document.addEventListener("click", e => {
  const id = e.target.id;
  if (id === "stop-all") stopAll();
  if (id === "mix-sleep") applySleepMix();
  if (id === "mix-rainy") applyRainyMix();
  if (id === "mix-reading") applyReadingMix();
  if (id === "mix-cozy") applyCozyMix(); // ‚úÖ new cozy mix
  Object.keys(tracks).forEach(k => {
    if (id === tracks[k].btn) togglePlay(k);
  });
});

document.addEventListener("input", e => {
  Object.keys(tracks).forEach(k => {
    if (e.target.id === tracks[k].vol) setVolume(k, +e.target.value);
  });
});
</script>
<script src="https://www.youtube.com/iframe_api"></script>


  <script>
    if('serviceWorker'in navigator){ navigator.serviceWorker.getRegistrations().then(regs=>regs.forEach(r=>r.update())); }
  </script>
</body>
</html>
